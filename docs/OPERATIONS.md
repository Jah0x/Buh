# Операции и обслуживание

## Запуск

- Production: используйте systemd/PM2 для запуска `python -m app.main`.
- Убедитесь, что открыт порт `WEB_PORT` (по умолчанию 8080) для вебхуков ЮKassa.

## Миграции

- Просмотр состояния: `alembic current`
- Создание новой ревизии: `alembic revision --autogenerate -m "message"`
- Применение миграций: `alembic upgrade head`

## Логи

- Логи пишутся в stdout. Для системного сервиса перенаправьте в файл или используйте journald.
- Уровень логирования настраивается переменной `LOG_LEVEL`.

## Вебхуки ЮKassa

- URL: `https://<PUBLIC_BASE_URL>/payments/yookassa/webhook`
- Настройте в личном кабинете ЮKassa, используйте HTTPS.
- После успешной оплаты бот отправляет пользователю PDF-договор и обновляет статус контракта.

## Резервное копирование

- Храните бэкапы БД (PostgreSQL/SQLite) и каталога `data/` (треки, обложки, договоры, согласия).
- Для PostgreSQL рекомендуются регулярные дампы `pg_dump`.

## Обновление зависимостей

- Проверяйте `requirements.txt` и обновляйте зависимости через `pip install -r requirements.txt --upgrade`.
- После обновления выполняйте smoke-тесты и миграции на staging.
