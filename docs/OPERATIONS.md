# Операции и обслуживание

## Логирование и ротация

- Приложение пишет структурированные логи в stdout через стандартный `logging`.
- Для production-среды подключайте systemd-journald, Docker logging driver или внешние APM-сервисы.
- Если требуются файлы, используйте ротацию через `logrotate`/systemd (ежедневно, хранить 14 дней, сжатие). Следите, чтобы логи не содержали персональных данных.

## Резервное копирование

- Основной источник данных — база (SQLite/PostgreSQL) и каталог `data/` с загруженными файлами и PDF-документами.
- Для PostgreSQL настройте ежедневные дампы `pg_dump` и проверяйте восстановление на отдельном стенде.
- Для локального хранения файлов используйте snapshot- или rsync-бэкапы, синхронизируйте их с отказоустойчивым хранилищем.
- Проверяйте целостность бэкапов (hash, пробное восстановление) не реже одного раза в месяц.

## Обновления и релизы

1. Подготовьте новую версию в тестовой среде: обновите зависимости `pip install -r requirements.txt --upgrade`, прогоните миграции `alembic upgrade head`.
2. Проведите smoke-тесты: запуск бота, создание тестового релиза, проверка генерации договора.
3. На production выполните деплой с предварительным оповещением: остановите сервис, задеплойте код, выполните миграции, перезапустите процесс (`python -m app.main` или системный юнит).
4. Мониторьте логи в течение первого часа, убедитесь, что вебхуки успешно обрабатываются.

## Плановое обслуживание

- Периодически проверяйте размер каталога `data/` и освобождайте устаревшие файлы согласно политике хранения.
- Обновляйте `.env` при изменении реквизитов и держите историю версий в секретном менеджере.
- Тестируйте восстановление из бэкапа после изменений в схеме данных или договорном шаблоне.
