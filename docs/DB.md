# Схема базы данных

## Технологии

- SQLAlchemy 2.0 (асинхронный движок + типизированные модели).
- Alembic для миграций и версионирования схемы.
- SQLite в разработке, PostgreSQL в продакшене.

## Основные сущности

- **users** — Telegram-пользователи бота. Хранятся идентификаторы (`telegram_id`), базовый профиль и дата регистрации.
- **releases** — карточки релизов с метаданными (название трека, авторы, описания, пути к файлам). Связаны с `users`.
- **consents** — зафиксированные согласия на обработку данных. Содержат ссылку на пользователя/релиз, версию текста и момент принятия.
- **contracts** — информация о сформированных договорах: статусы, пути к PDF, временные метки отправки/подписания.
- **payments** — хранят статусы транзакций и связь с релизом. Детали взаимодействия описываются отдельно (см. документацию по платежам после интеграции).

## Связи и ограничения

- Один пользователь может иметь несколько релизов (`users` 1→N `releases`).
- Для каждого релиза фиксируется одно активное согласие и один договор, но таблицы допускают историю (статусные поля и временные метки).
- Внешние ключи обеспечивают каскадное удаление вспомогательных записей при удалении релиза.

## Работа с миграциями

- Базовая структура создаётся командой `alembic upgrade head`.
- Новые изменения оформляйте через `alembic revision --autogenerate -m "description"` с последующим ручным ревью.
- В production миграции запускаются перед развёртыванием новой версии приложения.
