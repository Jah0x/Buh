# Договоры с артистами

## Назначение

После успешной оплаты бот формирует договор между студией и артистом, сохраняет PDF-копию и отправляет документ по электронной почте. Договор подтверждает права на выпуск релиза и фиксирует ключевые условия сотрудничества.

## Ключевые элементы договора

- Реквизиты студии и артиста, включая данные, собранные в боте.
- Перечень материалов релиза и права, которые передаются студии.
- Порядок взаиморасчётов и подтверждение получения оплаты.
- Права и обязанности сторон, включая согласие на обработку данных и использование материалов.

## Процесс подготовки

1. После фиксации платежа формируется контекст договора на основе релиза, согласия и записи о платеже.
2. Генератор создаёт PDF-файл в `data/contracts/<release_id>/<timestamp>.pdf`, запись добавляется в таблицу `contracts`.
3. В таблицу `mail_outbox` попадает письмо с вложением и ссылкой на подтверждение (`/contract/accept?token=...`).
4. Воркер SMTP рассылает письма с бэкофом и отмечает статус договора как `sent`.
5. Артист подтверждает договор по ссылке, после чего запись обновляется до статуса `signed`.

## Управление и хранение

- Актуальный шаблон договора хранится в `app/contracts/templates/` и может быть обновлён в рамках юридической политики.
- История версий фиксируется через систему контроля версий и резервные копии каталога `data/contracts/`.
- Для повторного направления договора создайте новую запись в `mail_outbox` с ссылкой на существующий PDF и обновите токен подписи в записи `contracts`.
- Принятые токены недействительны повторно, факт подписи фиксируется в полях `status`, `signed_at` и `accept_token_used_at`.
